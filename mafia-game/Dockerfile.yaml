FROM node:20.17
WORKDIR /app
COPY package.json package-lock.json* ./
RUN npm install -g npm@11.6.0
RUN npm cache clean --force && \
    npm install -g npm@latest && \
    npm install
COPY . .
ENV NEXT_TELEMETRY_DISABLED 1
RUN npm run build
ENV NODE_ENV production
USER 10014
EXPOSE 8080
ENV HOSTNAME 0.0.0.0
ENV PORT 8080
CMD ["./node_modules/.bin/next", "start"]